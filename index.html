<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Upload & Share</title>
  <style>
    body { font-family: 'Inter', 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background: #f6f8fb; }
    h1 {
      text-align: center;
      font-size: 3.5rem;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      font-weight: 900;
      margin-bottom: 0;
      letter-spacing: 0.03em;
      line-height: 1.12;
    }
    .subtitle {
      text-align: center;
      color: #888;
      margin-top: 60px;
      margin-bottom: 48px;
      font-size: 1.18rem;
      font-weight: 400;
      letter-spacing: 0.01em;
    }
    #dropArea {
      border: 2.5px solid #b3d8fd;
      border-radius: 12px;
      padding: 36px 0;
      text-align: center;
      color: #007bff;
      background: #fafdff;
      margin-bottom: 38px;
      width: 100%;
      font-size: 1.13rem;
      transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
      cursor: pointer;
      font-weight: 500;
      box-shadow: 0 2px 12px rgba(0,123,255,0.04);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    #dropArea.dragover {
      background: #eaf4ff;
      border-color: #90c2fa;
      color: #0056b3;
      box-shadow: 0 4px 24px rgba(0,123,255,0.10);
    }
    #customFileBtn {
      background: linear-gradient(90deg, #2196f3 0%, #007bff 100%);
      color: #fff !important;
      border: none !important;
      border-radius: 8px;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px rgba(0,123,255,0.08);
      font-size: 1.08rem;
      font-weight: 600;
      padding: 12px 28px;
      outline: none;
    }
    #customFileBtn:hover, #customFileBtn:focus {
      background: linear-gradient(90deg, #007bff 0%, #2196f3 100%);
      color: #fff !important;
      box-shadow: 0 6px 24px rgba(0,86,179,0.13);
      transform: translateY(-2px) scale(1.03);
    }
    button[type="submit"] {
      background: linear-gradient(90deg, #2196f3 0%, #007bff 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px rgba(0,123,255,0.08);
      font-size: 1.22rem;
      font-weight: 700;
      padding: 0 48px;
      margin-top: 10px;
      margin-bottom: 18px;
      width: auto;
      min-width: 220px;
      outline: none;
      height: 54px;
      line-height: 54px;
      display: flex;
      align-items: center;
      justify-content: center;
      letter-spacing: 0.01em;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    button[type="submit"]:hover, button[type="submit"]:focus {
      background: linear-gradient(90deg, #007bff 0%, #2196f3 100%);
      box-shadow: 0 6px 24px rgba(0,86,179,0.13);
      transform: translateY(-2px) scale(1.03);
    }
    button[type="button"] {
      background: linear-gradient(90deg, #2196f3 0%, #007bff 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px rgba(0,123,255,0.08);
      font-size: 1rem;
      font-weight: 600;
      padding: 8px 18px;
      outline: none;
      margin-left: 6px;
    }
    button[type="button"]:hover, button[type="button"]:focus {
      background: linear-gradient(90deg, #007bff 0%, #2196f3 100%);
      box-shadow: 0 6px 24px rgba(0,86,179,0.13);
      transform: translateY(-1px) scale(1.04);
    }
    button[onclick^="deleteHistory"] {
      background: #f44336 !important;
      color: #fff !important;
      border-radius: 8px;
      margin-left: 6px;
      box-shadow: 0 2px 8px rgba(244,67,54,0.08);
      font-weight: 600;
    }
    button[onclick^="deleteHistory"]:hover, button[onclick^="deleteHistory"]:focus {
      background: #d32f2f !important;
      box-shadow: 0 6px 24px rgba(244,67,54,0.13);
    }
    #fileRow {
      width: 100%;
      margin-bottom: 10px;
    }
    #fileName {
      font-size: 1.05rem;
      color: #555;
      font-weight: 400;
    }
    .result {
      margin-top: 38px;
      text-align: center;
      font-size: 1.13rem;
      width: 100%;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
      background: none;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
      display: none;
    }
    .result.show {
      display: block;
    }
    .result img {
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      margin-bottom: 18px;
      max-width: 100%;
      height: auto;
    }
    .result .copy-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 12px;
    }
    .result input[type="text"] {
      width: 60%;
      font-size: 0.98rem;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 6px 8px;
      background: #fafbfc;
      margin-right: 0;
    }
    .result button[type="button"] {
      margin-left: 0;
      min-width: 70px;
    }
    .result a {
      color: #007bff;
      text-decoration: underline;
      font-size: 1.08rem;
      margin-top: 10px;
      display: inline-block;
    }
    /* 上传区与按钮间距拉开 */
    #dropArea {
      margin-bottom: 38px;
    }
    #history {
      margin-top: 40px;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 22px 16px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.04);
      width: 100%;
      max-width: 600px;
    }
    #history b {
      font-size: 1.13rem;
      font-weight: 700;
    }
    #history a {
      color: #007bff;
      word-break: break-all;
    }
    #history img {
      display: block;
      margin: 8px auto 0 auto;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }
    #history hr {
      margin: 16px 0;
    }
    #toast {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%) scale(0.98);
      background: rgba(30, 30, 30, 0.82);
      color: #fff;
      padding: 20px 36px;
      border-radius: 22px;
      font-size: 1.13rem;
      z-index: 9999;
      box-shadow: 0 6px 32px 0 rgba(0,0,0,0.18), 0 1.5px 6px 0 rgba(0,0,0,0.10);
      text-align: center;
      min-width: 180px;
      max-width: 92vw;
      font-weight: 600;
      letter-spacing: 0.01em;
      white-space: pre-line;
      word-break: keep-all;
      transition: opacity 0.32s cubic-bezier(.4,0,.2,1), transform 0.32s cubic-bezier(.4,0,.2,1);
      opacity: 0;
      pointer-events: none;
      backdrop-filter: blur(8px) saturate(1.2);
      -webkit-backdrop-filter: blur(8px) saturate(1.2);
      line-height: 1.5;
    }
    #toast.toast-show {
      display: block;
      opacity: 1;
      transform: translate(-50%,-50%) scale(1);
      pointer-events: auto;
    }
    /* 让文件选择行居中 */
    #fileRow {
      width: 100%;
      margin-bottom: 10px;
      display: flex !important;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    /* 上传结果区每行横向布局，标签宽度统一，按钮紧贴input */
    .result .copy-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0;
      margin-bottom: 16px;
      width: 100%;
      flex-wrap: wrap;
    }
    .result .copy-label {
      width: 110px;
      min-width: 90px;
      text-align: right;
      font-size: 1.08rem;
      font-weight: 500;
      color: #222;
      margin-right: 10px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .result input[type="text"] {
      width: 60%;
      min-width: 0;
      font-size: 0.98rem;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 6px 8px;
      background: #fafbfc;
      margin-right: 0;
      flex: 1 1 120px;
    }
    .result button[type="button"] {
      margin-left: 10px;
      min-width: 70px;
      flex-shrink: 0;
    }
    /* 响应式：移动端100%宽度，自动换行 */
    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; }
      .subtitle { font-size: 1rem; }
      #dropArea { padding: 10vw 2vw; font-size: 1rem; }
      button[type="submit"] { font-size: 1rem; padding: 12px 0; }
      #toast { font-size: 1.01rem; padding: 14px 6vw; min-width: 120px; line-height: 1.7; }
      .result .copy-row {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }
      .result .copy-label {
        text-align: left;
        margin-bottom: 2px;
        margin-right: 0;
        width: 100%;
      }
      .result input[type="text"] {
        width: 100%;
        margin-bottom: 4px;
      }
      .result button[type="button"] {
        width: 100%;
        margin-left: 0;
      }
      #fileRow {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }
    }
  </style>
</head>
<body>
  <!-- 平铺布局，无container卡片 -->
  <h1>Image Upload & Share</h1>
  <p class="subtitle">Quickly upload images and get shareable links for free.</p>
  <div id="dropArea">Drag & drop image here or <span id="dropChoose" style="color:#007bff;text-decoration:underline;cursor:pointer;">choose file</span></div>
  <input type="file" name="image" id="imageInput" accept="image/*" style="display:none;" />
  <div id="fileName" style="text-align:center;color:#666;font-size:1.05rem;margin-top:10px;min-height:1.5em;"></div>
  <div id="progressBar" style="display:none;width:96%;height:8px;background:#e3f0ff;border-radius:4px;overflow:hidden;margin:10px auto 0 auto;max-width:420px;">
    <div id="progressInner" style="height:100%;width:0;background:linear-gradient(90deg,#2196f3 0%,#007bff 100%);transition:width 0.2s;"></div>
  </div>
  <div class="result" id="result"></div>
  <div id="toast"></div>
  <!-- 结束平铺布局 -->
  <script>
    const result = document.getElementById('result');
    // 自动上传逻辑
    function uploadImage(file) {
      if (!file) return;
      const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/heic', 'image/heif'];
      const isHeicExt = /\.heic$/i.test(file.name) || /\.heif$/i.test(file.name);
      if ((file.type && !allowedTypes.includes(file.type)) && !isHeicExt) {
        showToast('Only jpg, jpeg, png, gif, webp, heic formats are supported!');
        return;
      }
      if (file.type === 'image/heic' || file.type === 'image/heif' || isHeicExt) {
        showToast('HEIC will be converted to JPG for preview.');
      }
      const formData = new FormData();
      formData.append('image', file);
      result.textContent = 'Uploading...';
      showProgress(0);
      result.classList.remove('show');
      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/upload');
      xhr.upload.onprogress = function(e) {
        if (e.lengthComputable) {
          const percent = Math.round((e.loaded / e.total) * 100);
          showProgress(percent);
        }
      };
      xhr.onload = function() {
        hideProgress();
        let data = {};
        try { data = JSON.parse(xhr.responseText); } catch {}
        if (data.url) {
          const direct = location.origin + data.url;
          const markdown = `![](${direct})`;
          result.innerHTML = `
            <div style="margin-bottom:18px;font-weight:bold;font-size:1.18rem;">Upload successful!</div>
            <img src="${data.url}" alt="Image" style="border-radius:10px;box-shadow:0 1px 6px rgba(0,0,0,0.08);margin-bottom:18px;max-width:100%;height:auto;" />
            <div class="copy-row"><span class="copy-label">Direct Link:</span><input type="text" value="${direct}" readonly /><button type="button" onclick="copyToClipboard('${direct}', this)">Copy</button></div>
            <div class="copy-row"><span class="copy-label">Markdown:</span><input type="text" value="${markdown}" readonly /><button type="button" onclick="copyToClipboard('${markdown}', this)">Copy</button></div>
            <div class="copy-row"><span class="copy-label">HTML:</span><input type="text" value="&lt;img src=&quot;${direct}&quot; alt=&quot;Image&quot; /&gt;" readonly /><button type="button" onclick="copyHtmlToClipboard(this)">Copy</button></div>
            <div style="margin-bottom:8px;"><a href="${data.url}" target="_blank">View Image</a></div>
          `;
          result.classList.add('show');
        } else {
          result.classList.remove('show');
          result.textContent = data.error || 'Upload failed';
        }
      };
      xhr.onerror = function() {
        hideProgress();
        result.classList.remove('show');
        result.textContent = 'Upload failed, please try again';
      };
      xhr.send(formData);
    }
    // 拖拽上传功能
    // 保证fileInput2和fileInput都指向id为imageInput的input元素
    const fileInput = document.getElementById('imageInput');
    const fileInput2 = fileInput;
    const fileNameSpan = document.getElementById('fileName');
    const dropArea = document.getElementById('dropArea');
    const dropChoose = document.getElementById('dropChoose');
    dropArea.addEventListener('click', () => fileInput.click());
    dropChoose.addEventListener('click', e => { e.stopPropagation(); fileInput.click(); });
    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        fileNameSpan.textContent = fileInput.files[0].name;
        uploadImage(fileInput.files[0]);
      } else {
        fileNameSpan.textContent = '';
      }
    });
    ['dragenter','dragover'].forEach(evt => dropArea.addEventListener(evt, e => {
      e.preventDefault(); e.stopPropagation(); dropArea.classList.add('dragover');
    }));
    ['dragleave','drop'].forEach(evt => dropArea.addEventListener(evt, e => {
      e.preventDefault(); e.stopPropagation(); dropArea.classList.remove('dragover');
    }));
    dropArea.addEventListener('drop', e => {
      if (e.dataTransfer.files && e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        fileNameSpan.textContent = fileInput.files[0].name;
        uploadImage(fileInput.files[0]);
      }
    });
    // 自定义文件选择按钮逻辑
    const customFileBtn = document.getElementById('customFileBtn');
    customFileBtn.addEventListener('click', () => fileInput.click());

    // Save history to localStorage
    function saveHistory(url) {
      const history = JSON.parse(localStorage.getItem('uploadHistory') || '[]');
      history.unshift({ url, time: new Date().toLocaleString() });
      // Keep at most 20 records
      if (history.length > 20) history.length = 20;
      localStorage.setItem('uploadHistory', JSON.stringify(history));
    }

    // Render history
    function renderHistory() {
      let history = [];
      try { history = JSON.parse(localStorage.getItem('uploadHistory') || '[]'); } catch {}
      const historyDiv = document.getElementById('history');
      if (!historyDiv) return;
      if (!history.length) {
        historyDiv.innerHTML = '<em>No history records</em>';
        return;
      }
      historyDiv.innerHTML = '<b>Upload History:</b><br>' + history.map((item, idx) =>
        `<a href="${item.url}" target="_blank">${item.url}</a>
         <button type="button" onclick="copyToClipboard('${item.url}', this)">Copy Link</button>
         <button type="button" onclick="deleteHistory(${idx})" style="margin-left:4px;background:#f44336;">Delete</button>
         <span style="color:#888;font-size:12px;">${item.time}</span><br><img src="${item.url}" alt="History Image" style="max-width:100px;max-height:60px;margin-bottom:10px;" />`
      ).join('<hr style="border:none;border-top:1px solid #eee;">');
    }

    // Delete history
    function deleteHistory(idx) {
      let history = [];
      try { history = JSON.parse(localStorage.getItem('uploadHistory') || '[]'); } catch {}
      history.splice(idx, 1);
      localStorage.setItem('uploadHistory', JSON.stringify(history));
      renderHistory();
    }

    // Copy to clipboard and show toast
    function copyToClipboard(text, btn) {
      navigator.clipboard.writeText(text).then(() => {
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        btn.disabled = true;
        setTimeout(() => {
          btn.textContent = old;
          btn.disabled = false;
        }, 1200);
      });
    }

    function showProgress(percent) {
      const bar = document.getElementById('progressBar');
      const inner = document.getElementById('progressInner');
      bar.style.display = 'block';
      inner.style.width = percent + '%';
    }
    function hideProgress() {
      const bar = document.getElementById('progressBar');
      const inner = document.getElementById('progressInner');
      inner.style.width = '0';
      setTimeout(() => { bar.style.display = 'none'; }, 400);
    }

    // Toast popup
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('toast-show');
      setTimeout(() => { toast.classList.remove('toast-show'); }, 1500);
    }

    // Render history on page load
    window.onload = renderHistory;

    function copyHtmlToClipboard(btn) {
      const input = btn.previousElementSibling;
      const html = input.value.replace(/&quot;/g, '"').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
      navigator.clipboard.writeText(html).then(() => {
        const old = btn.textContent;
        btn.textContent = 'Copied!';
        btn.disabled = true;
        setTimeout(() => {
          btn.textContent = old;
          btn.disabled = false;
        }, 1200);
      });
    }
  </script>
</body>
</html> 